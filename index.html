<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Czy dzi≈õ w nas walnie? ‚Äî Asteroidy blisko Ziemi</title>
<meta name="description" content="Sprawd≈∫, kt√≥re asteroidy przelatujƒÖ blisko Ziemi w najbli≈ºszych dniach. Dane NASA w czasie rzeczywistym. Dinozaury trzymajƒÖ kciuki.">
<meta name="author" content="Pawe≈Ç Lewi≈Ñski">
<meta name="theme-color" content="#070b14">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=Outfit:wght@300;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #070b14;
  --ground: #1a2612;
  --ground-light: #2d3d1f;
  --safe: #22c55e;
  --danger: #ef4444;
  --warn: #f59e0b;
  --accent: #f59e0b;
  --text: #e2e8f0;
  --muted: #64748b;
  --card: #0f1629;
  --card-border: rgba(255,255,255,0.06);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Outfit', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ‚îÄ‚îÄ Starfield ‚Äî 3 layers: dim, medium, bright ‚îÄ‚îÄ */
#starfield { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
#starfield .layer { position: absolute; border-radius: 50%; background: white; }
#starfield .dim    { width: 1px; height: 1px; }
#starfield .med    { width: 1.5px; height: 1.5px; }
#starfield .bright { width: 2px; height: 2px; }
@keyframes twinkle { 0%,100% { opacity: 0.3; } 50% { opacity: 1; } }

/* ‚îÄ‚îÄ Comets ‚Äî JS-generated for correct tail alignment ‚îÄ‚îÄ */
.comet {
  position: fixed;
  z-index: 1;
  pointer-events: none;
  height: 6px;
  border-radius: 3px 50% 50% 3px;
  opacity: 0;
}

.comet::after {
  content: '';
  position: absolute;
  right: -5px;
  top: 50%;
  transform: translateY(-50%);
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: radial-gradient(circle, #fff 25%, rgba(var(--comet-color), 0.8) 50%, transparent 100%);
  box-shadow: 0 0 10px 4px rgba(var(--comet-color), 0.6), 0 0 25px 8px rgba(var(--comet-color), 0.25);
}

/* ‚îÄ‚îÄ Hero ‚îÄ‚îÄ */
.hero {
  position: relative;
  min-height: 420px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 3rem 1.5rem 6rem;
  overflow: hidden;
  z-index: 1;
}

.hero::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 120px;
  background: linear-gradient(to top, var(--ground), transparent);
  pointer-events: none;
}

.hero h1 {
  font-family: 'Dela Gothic One', cursive;
  font-size: clamp(2rem, 6vw, 3.5rem);
  line-height: 1.15;
  color: #fff;
  margin-bottom: 0.75rem;
  position: relative;
  z-index: 2;
  text-shadow: 0 0 40px rgba(245,158,11,0.3);
}

.hero h1 em {
  font-style: normal;
  color: var(--accent);
}

.hero-sub {
  font-size: clamp(0.95rem, 2.2vw, 1.15rem);
  font-weight: 300;
  color: var(--muted);
  max-width: 500px;
  position: relative;
  z-index: 2;
  margin-bottom: 1.5rem;
}

.hero-dino-comment {
  font-size: 1.15rem;
  font-weight: 600;
  color: rgba(255,255,255,0.85);
  font-style: italic;
  position: relative;
  z-index: 2;
  max-width: 500px;
}

/* ‚îÄ‚îÄ Dinosaur scene ‚îÄ‚îÄ */
.dino-scene {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 160px;
  z-index: 1;
}

.dino-ground {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 60px;
  background: linear-gradient(to top, var(--ground) 60%, var(--ground-light) 100%);
}

.dino-scene svg {
  position: absolute;
  bottom: 20px;
}

.dino-trex {
  left: 8%;
  width: 100px;
  height: 110px;
  opacity: 0.7;
  animation: dino-look 6s ease-in-out infinite;
}

.dino-bronto {
  left: 55%;
  width: 140px;
  height: 130px;
  opacity: 0.6;
  animation: dino-look 8s ease-in-out infinite;
  animation-delay: 2s;
}

.dino-trice {
  right: 10%;
  width: 90px;
  height: 70px;
  opacity: 0.65;
  animation: dino-look 7s ease-in-out infinite;
  animation-delay: 4s;
}

.dino-ptero {
  position: absolute;
  top: 30%;
  right: 20%;
  width: 60px;
  height: 40px;
  opacity: 0.35;
  animation: ptero-fly 12s ease-in-out infinite;
}

@keyframes dino-look {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}

@keyframes ptero-fly {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  25% { transform: translate(-30px, -15px) rotate(-3deg); }
  50% { transform: translate(20px, -25px) rotate(2deg); }
  75% { transform: translate(-10px, -10px) rotate(-1deg); }
}

/* Palm trees */
.palm {
  position: absolute;
  bottom: 30px;
  opacity: 0.4;
}
.palm-1 { left: 30%; width: 40px; height: 80px; }
.palm-2 { right: 30%; width: 35px; height: 70px; transform: scaleX(-1); }

/* ‚îÄ‚îÄ Alert bar ‚îÄ‚îÄ */
#alert-bar {
  position: relative;
  z-index: 2;
  text-align: center;
  padding: 20px;
  font-family: 'Dela Gothic One', cursive;
  font-size: clamp(1.1rem, 3vw, 1.5rem);
  letter-spacing: 1px;
  color: #fff;
  background: linear-gradient(135deg, #16a34a, #22c55e, #16a34a);
  background-size: 200% 200%;
  animation: shimmer-bar 4s ease-in-out infinite;
  border-top: 1px solid rgba(255,255,255,0.1);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  text-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

#alert-bar.danger {
  background: linear-gradient(135deg, #dc2626, #ef4444, #dc2626);
  background-size: 200% 200%;
  animation: shimmer-bar 4s ease-in-out infinite, pulse-alert 2s ease-in-out infinite;
}

#alert-bar.warn {
  background: linear-gradient(135deg, #d97706, #f59e0b, #d97706);
  background-size: 200% 200%;
}

#alert-bar .alert-sub {
  font-family: 'Outfit', sans-serif;
  font-size: 0.8rem;
  font-weight: 500;
  letter-spacing: 0.5px;
  opacity: 0.85;
  margin-top: 4px;
}

@keyframes shimmer-bar {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

@keyframes pulse-alert {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.85; }
}

/* ‚îÄ‚îÄ Countdown ‚îÄ‚îÄ */
.countdown-section {
  position: relative;
  z-index: 1;
  padding: 2rem 1.5rem;
  text-align: center;
  background: linear-gradient(to bottom, var(--ground), var(--bg) 40%);
}

.countdown-label {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 2px;
}

.countdown-name {
  font-family: 'Dela Gothic One', cursive;
  font-size: 1.2rem;
  color: var(--accent);
  margin: 6px 0;
}

.countdown-time {
  font-family: 'JetBrains Mono', monospace;
  font-size: clamp(2rem, 5vw, 3rem);
  font-weight: 700;
  color: #fff;
  letter-spacing: 2px;
}

.countdown-stats {
  display: flex;
  justify-content: center;
  gap: 1.5rem;
  margin-top: 1rem;
  flex-wrap: wrap;
}

.cd-stat {
  text-align: center;
}

.cd-stat .cd-stat-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 1.3rem;
  font-weight: 700;
}

.cd-stat .cd-stat-label {
  font-size: 0.7rem;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.cd-stat.dist .cd-stat-value { color: var(--accent); }
.cd-stat.speed .cd-stat-value { color: #38bdf8; }
.cd-stat.size .cd-stat-value { color: #a78bfa; }

/* ‚îÄ‚îÄ Asteroid list ‚îÄ‚îÄ */
.asteroids-section {
  position: relative;
  z-index: 1;
  max-width: 800px;
  margin: 0 auto;
  padding: 0 1.5rem 2rem;
}

.section-title {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 1rem;
  text-align: center;
}

.asteroid-card {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 1.25rem 1.5rem;
  margin-bottom: 10px;
  transition: border-color 0.2s, transform 0.2s;
}

.asteroid-card:hover {
  border-color: rgba(245,158,11,0.2);
  transform: translateY(-1px);
}

.asteroid-card.threat-safe {
  background: linear-gradient(135deg, rgba(34,197,94,0.18), rgba(34,197,94,0.06));
  border-left: 3px solid rgba(34,197,94,0.6);
}

.asteroid-card.threat-medium {
  background: linear-gradient(135deg, rgba(250,204,21,0.18), rgba(250,204,21,0.06));
  border-left: 3px solid rgba(250,204,21,0.6);
}

.asteroid-card.threat-danger {
  background: linear-gradient(135deg, rgba(248,80,80,0.20), rgba(248,80,80,0.07));
  border-left: 3px solid rgba(248,80,80,0.65);
}

.asteroid-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 0.75rem;
}

.asteroid-icon {
  font-size: 1.6rem;
  width: 42px;
  height: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  background: rgba(245,158,11,0.08);
  flex-shrink: 0;
}

.asteroid-header h3 {
  font-weight: 700;
  font-size: 0.95rem;
}

.asteroid-header .date {
  font-size: 0.8rem;
  color: var(--muted);
}

.asteroid-header .hazard-tag {
  display: inline-block;
  font-size: 0.7rem;
  font-weight: 700;
  padding: 0.15rem 0.5rem;
  border-radius: 4px;
  background: rgba(239,68,68,0.12);
  color: var(--danger);
  margin-left: auto;
  flex-shrink: 0;
}

.asteroid-stats-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 8px;
}

.stat-cell {
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  padding: 0.6rem 0.5rem;
  text-align: center;
}

.stat-cell .stat-label {
  font-size: 0.6rem;
  font-weight: 600;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 3px;
}

.stat-cell .stat-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 1.2rem;
  font-weight: 700;
  color: #fff;
  line-height: 1.2;
}

.stat-cell .stat-sub {
  font-size: 0.7rem;
  color: var(--muted);
  margin-top: 1px;
}

.stat-cell.s-dist .stat-value { color: var(--accent); }
.stat-cell.s-speed .stat-value { color: #38bdf8; }
.stat-cell.s-size .stat-value { color: #a78bfa; }

.cd-stat .cd-stat-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 1.5rem;
  font-weight: 700;
}

.cd-stat .cd-stat-label {
  font-size: 0.75rem;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* ‚îÄ‚îÄ Fun facts ‚îÄ‚îÄ */
.funfact-section {
  position: relative;
  z-index: 1;
  max-width: 600px;
  margin: 1rem auto 0;
  padding: 0 1.5rem 2rem;
  text-align: center;
}

.funfact-box {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 1.5rem;
}

.funfact-box .dino-emoji {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.funfact-box p {
  font-size: 0.9rem;
  color: var(--muted);
  line-height: 1.6;
}

.funfact-box strong {
  color: var(--text);
}

/* ‚îÄ‚îÄ Status bar ‚îÄ‚îÄ */
.status-bar {
  text-align: center;
  padding: 10px;
  font-size: 0.7rem;
  color: var(--muted);
  position: relative;
  z-index: 1;
}

.status-bar .dot {
  display: inline-block;
  width: 6px;
  height: 6px;
  background: var(--safe);
  border-radius: 50%;
  margin-right: 4px;
  animation: blink 2s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
#loading {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 100;
  transition: opacity 0.5s;
}

#loading.hidden { opacity: 0; pointer-events: none; }

.loader-asteroid {
  font-size: 2.5rem;
  animation: spin-asteroid 2s linear infinite;
}

@keyframes spin-asteroid {
  to { transform: rotate(360deg); }
}

#loading p {
  margin-top: 16px;
  font-size: 0.9rem;
  color: var(--muted);
}

/* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
.asteroid-card {
  opacity: 0;
  transform: translateY(12px);
  animation: fadeUp 0.4s ease forwards;
}

@keyframes fadeUp {
  to { opacity: 1; transform: translateY(0); }
}

/* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
@media (max-width: 600px) {
  .hero { min-height: 350px; padding: 2.5rem 1rem 5rem; }
  .dino-trex { width: 70px; height: 77px; left: 3%; }
  .dino-bronto { width: 100px; height: 93px; }
  .dino-trice { width: 65px; height: 51px; right: 3%; }
  .dino-ptero { width: 40px; height: 27px; }
  .asteroid-stats-row {
    grid-template-columns: 1fr;
    gap: 6px;
  }
  .stat-cell {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.4rem 0.6rem;
    text-align: left;
  }
  .stat-cell .stat-label { margin-bottom: 0; }
  .stat-cell .stat-sub { margin-top: 0; margin-left: 6px; }
}
</style>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ETB0X7ZBLH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ETB0X7ZBLH');
</script>
</head>
<body>

<div id="loading">
  <div class="loader-asteroid">‚òÑÔ∏è</div>
  <p id="loading-text">Skanowanie kosmosu...</p>
</div>

<div id="starfield"></div>

<div id="comet-container"></div>

<!-- Hero -->
<section class="hero">
  <h1>Czy dzi≈õ w nas <em>walnie</em>?</h1>
  <p class="hero-sub">Asteroidy przelatujƒÖce blisko Ziemi w najbli≈ºszych 7 dniach. Dane NASA w czasie rzeczywistym.</p>
  <div class="hero-dino-comment" id="dino-comment">ü¶ï ‚Äû66 milion√≥w lat bez incydentu. Na razie."</div>

  <div class="dino-scene">
    <div class="dino-ground"></div>
  </div>
</section>

<!-- Alert -->
<div id="alert-bar">
  Skanowanie...
</div>

<!-- Countdown -->
<div class="countdown-section">
  <div class="countdown-label" id="cd-label">Najbli≈ºszy przelot</div>
  <div class="countdown-name" id="cd-name">‚Äî</div>
  <div class="countdown-time" id="cd-time">--:--:--</div>
  <div class="countdown-stats" id="cd-stats"></div>
</div>

<!-- Asteroid list -->
<div class="asteroids-section">
  <div class="section-title" id="list-title">Asteroidy w najbli≈ºszych 7 dniach</div>
  <div id="asteroid-list"></div>
</div>

<!-- Fun fact -->
<div class="funfact-section">
  <div class="funfact-box" id="funfact">
    <div class="dino-emoji">ü¶ñ</div>
    <p>≈Åadowanie mƒÖdro≈õci dinozaur√≥w...</p>
  </div>
</div>

<!-- Status -->
<div class="status-bar">
  <span class="dot"></span>
  <span id="status-text">≈ÅƒÖczenie z NASA...</span>
</div>

<script>
// ‚îÄ‚îÄ STARFIELD ‚îÄ‚îÄ
(function() {
  const sf = document.getElementById('starfield');
  const stars = 320;
  for (let i = 0; i < stars; i++) {
    const d = document.createElement('div');
    d.className = 'layer ' + (i < 200 ? 'dim' : i < 280 ? 'med' : 'bright');
    d.style.left = (Math.random() * 100) + '%';
    d.style.top = (Math.random() * 100) + '%';
    d.style.opacity = (0.2 + Math.random() * 0.7).toFixed(2);
    // kilka gwiazd lekko migocze
    if (Math.random() < 0.15) {
      d.style.animation = `twinkle ${2 + Math.random() * 4}s ease-in-out infinite`;
      d.style.animationDelay = (Math.random() * 5) + 's';
    }
    sf.appendChild(d);
  }
})();

// ‚îÄ‚îÄ COMETS ‚Äî tail always opposite to flight direction ‚îÄ‚îÄ
(function() {
  const comets = [
    { startX: -5, startY: 8,  endX: 110, endY: 55, dur: 4,  delay: 2,  len: 400, h: 6, color: '245,158,11',  period: 10 },
    { startX: -3, startY: 25, endX: 105, endY: 50, dur: 3.5, delay: 8,  len: 300, h: 5, color: '56,189,248',  period: 12 },
    { startX: 70, startY: -3, endX: 30,  endY: 95, dur: 3,  delay: 15, len: 250, h: 4, color: '245,158,11',  period: 14 },
    { startX: -4, startY: 40, endX: 108, endY: 55, dur: 5,  delay: 22, len: 450, h: 6, color: '167,139,250', period: 16 },
  ];

  const container = document.getElementById('comet-container');

  comets.forEach((c, i) => {
    const el = document.createElement('div');
    el.className = 'comet';

    // KƒÖt lotu z wektora (dx, dy) ‚Äî w vw/vh, przeliczone na px dla proporcji
    const dx = (c.endX - c.startX) * window.innerWidth / 100;
    const dy = (c.endY - c.startY) * window.innerHeight / 100;
    const angle = Math.atan2(dy, dx) * (180 / Math.PI);

    el.style.width = c.len + 'px';
    el.style.height = c.h + 'px';
    el.style.left = c.startX + 'vw';
    el.style.top = c.startY + 'vh';
    el.style.transform = `rotate(${angle}deg)`;
    el.style.transformOrigin = 'right center';
    // Gradient: przezroczysty (ogon) ‚Üí kolor ‚Üí bia≈Ça g≈Ç√≥wka (prawy koniec = prz√≥d)
    el.style.background = `linear-gradient(90deg, transparent 0%, rgba(${c.color},0.03) 15%, rgba(${c.color},0.2) 60%, rgba(${c.color},0.6) 85%, #fff 100%)`;
    // glow na kulce ustawiany przez CSS custom property
    el.style.setProperty('--comet-color', c.color);

    // Animacja: translate wzd≈Çu≈º wektora lotu
    const name = `comet_fly_${i}`;
    const distX = c.endX - c.startX;
    const distY = c.endY - c.startY;
    const style = document.createElement('style');
    style.textContent = `
      @keyframes ${name} {
        0% { translate: 0 0; opacity: 0; }
        3% { opacity: 1; }
        ${Math.round(60 * c.dur / c.period * 10)}% { translate: ${distX}vw ${distY}vh; opacity: 0; }
        100% { translate: ${distX}vw ${distY}vh; opacity: 0; }
      }
    `;
    document.head.appendChild(style);
    el.style.animation = `${name} ${c.period}s ease-in infinite ${c.delay}s`;

    container.appendChild(el);
  });
})();

// ‚îÄ‚îÄ I18N ‚îÄ‚îÄ
const isPl = navigator.language.startsWith('pl');
document.documentElement.lang = isPl ? 'pl' : 'en';
const T = {
  pageTitle: isPl ? 'Czy dzi≈õ w nas walnie? ‚Äî Asteroidy blisko Ziemi' : 'Will we get hit today? ‚Äî Near-Earth Asteroids',
  loading: isPl ? 'Skanowanie kosmosu...' : 'Scanning the cosmos...',
  title: isPl ? 'Czy dzi≈õ w nas walnie?' : 'Will we get hit today?',
  titleEm: isPl ? 'walnie' : 'hit',
  sub: isPl ? 'Asteroidy przelatujƒÖce blisko Ziemi w najbli≈ºszych 7 dniach. Dane NASA w czasie rzeczywistym.' : 'Asteroids passing near Earth in the next 7 days. Real-time NASA data.',
  nextPass: isPl ? 'Najbli≈ºszy przelot' : 'Next flyby',
  listTitle: isPl ? 'Asteroidy w najbli≈ºszych 7 dniach' : 'Asteroids in the next 7 days',
  safe: isPl ? 'DZI≈ö JESTE≈öMY BEZPIECZNI' : 'WE ARE SAFE TODAY',
  safeSub: isPl ? '≈ªadna asteroida nie uderzy w Ziemiƒô. Dinozaury mogƒÖ spaƒá spokojnie.' : 'No asteroid will hit Earth. Dinosaurs can sleep well.',
  warnTitle: isPl ? 'BLISKO, ALE SPOKOJNIE' : 'CLOSE, BUT CALM DOWN',
  warnSub: isPl ? 'Potencjalnie niebezpieczna asteroida w okolicy. Ale NASA pilnuje.' : 'Potentially hazardous asteroid nearby. But NASA is watching.',
  hazardous: isPl ? 'Potencjalnie niebezpieczna' : 'Potentially hazardous',
  distance: isPl ? 'odleg≈Ço≈õƒá' : 'distance',
  moonTimes: isPl ? '√ó dalej ni≈º Ksiƒô≈ºyc' : '√ó farther than the Moon',
  closerThanMoon: isPl ? '√ó bli≈ºej ni≈º Ksiƒô≈ºyc!' : '√ó closer than the Moon!',
  speed: isPl ? 'prƒôdko≈õƒá' : 'speed',
  diameter: isPl ? '≈õrednica' : 'diameter',
  days: isPl ? 'd' : 'd',
  hours: isPl ? 'h' : 'h',
  min: isPl ? 'min' : 'min',
  sec: isPl ? 's' : 's',
  errorTitle: isPl ? 'NASA nie odpowiada' : 'NASA is not responding',
  errorSub: isPl ? 'Spr√≥buj od≈õwie≈ºyƒá stronƒô za chwilƒô.' : 'Try refreshing in a moment.',
};

// ‚îÄ‚îÄ SIZE COMPARISONS ‚îÄ‚îÄ
// Ref: samoch√≥d ~4m, autobus ~12m, boisko ~105m, stadion ~300m
function sizeCompare(minM, maxM) {
  const avg = (minM + maxM) / 2;
  if (avg < 2) return isPl ? ['kamyk z kosmosu','ü™®'] : ['space pebble','ü™®'];
  if (avg < 8) return isPl ? [`${Math.round(avg/4)}√ó samoch√≥d`,'üöó'] : [`${Math.round(avg/4)}√ó car`,'üöó'];
  if (avg < 50) return isPl ? [`${Math.round(avg/12)}√ó autobus`,'üöå'] : [`${Math.round(avg/12)}√ó bus`,'üöå'];
  if (avg < 200) return isPl ? [`${(avg/105).toFixed(1)}√ó boisko pi≈Çkarskie`,'‚öΩ'] : [`${(avg/105).toFixed(1)}√ó football pitch`,'‚öΩ'];
  if (avg < 600) return isPl ? [`${(avg/300).toFixed(1)}√ó stadion`,'üèüÔ∏è'] : [`${(avg/300).toFixed(1)}√ó stadium`,'üèüÔ∏è'];
  if (avg < 2000) return isPl ? [`${(avg/300).toFixed(0)}√ó stadion`,'‚õ∞Ô∏è'] : [`${(avg/300).toFixed(0)}√ó stadium`,'‚õ∞Ô∏è'];
  return isPl ? [`${(avg/1000).toFixed(1)} km ¬∑ dinozaury pamiƒôtajƒÖ...`,'‚òÑÔ∏è'] : [`${(avg/1000).toFixed(1)} km ¬∑ dinosaurs remember...`,'‚òÑÔ∏è'];
}

function distLabelShort(distLD) {
  if (distLD < 1) return `${(1/distLD).toFixed(1)}√ó`;
  return `${distLD.toFixed(1)}√ó`;
}

function distLabelUnit(distLD) {
  if (distLD < 1) return isPl ? 'bli≈ºej ni≈º Ksiƒô≈ºyc!' : 'closer than Moon!';
  return isPl ? 'dalej ni≈º Ksiƒô≈ºyc' : 'farther than Moon';
}

// ‚îÄ‚îÄ DINO COMMENTS ‚îÄ‚îÄ
const DINO_COMMENTS_SAFE = isPl ? [
  'ü¶ï ‚Äû66 milion√≥w lat bez incydentu. Na razie."',
  'ü¶ñ ‚ÄûSprawdzam codziennie. Dla pewno≈õci."',
  'ü¶ï ‚ÄûWolƒô wiedzieƒá zawczasu, wierz mi."',
  'ü¶ñ ‚ÄûOstatnim razem nie mieli≈õmy tej apki."',
  'ü¶ï ‚ÄûSpokojnie, NASA pilnuje. My nie mieli≈õmy NASA."',
  'ü¶ñ ‚ÄûJak nie walnie, to idziemy na paprocie."',
  'ü¶ï ‚ÄûPrzyjaciel Trike m√≥wi ≈ºe dzi≈õ spok√≥j. Ufam mu."',
  'ü¶ñ ‚ÄûNa pewno przeleci obok."',
  'ü¶ï ‚ÄûStatystycznie? Bezpieczni. Ale statystyka nas zabi≈Ça."',
  'ü¶ñ ‚ÄûZnowu fa≈Çszywy alarm. Jak zwykle. Jak wtedy."',
  'ü¶ï ‚ÄûPatrz jak ≈Çadnie leci. ≈Åadnie lecia≈Ç te≈º ten ostatni."',
  'ü¶ñ ‚ÄûPrzynajmniej wiemy, z kt√≥rej strony przyleci."',
  'ü¶ï ‚ÄûDzi≈õ tylko przelot turystyczny. Bez lƒÖdowania."',
  'ü¶ñ ‚ÄûNASA m√≥wi ≈ºe OK. A co NASA wie o dinozaurach?"',
  'ü¶ï ‚ÄûJeszcze jeden spokojny dzie≈Ñ w Mezozoiku... znaczy, w 2026."',
  'ü¶ñ ‚ÄûNie martwcie siƒô. To nie my powinni≈õmy siƒô martwiƒá. My ju≈º nie ≈ºyjemy."',
] : [
  'ü¶ï "66 million years without incident. So far."',
  'ü¶ñ "I check every day. Just to be safe."',
  'ü¶ï "I prefer to know in advance, trust me."',
  'ü¶ñ "Last time we didn\'t have this app."',
  'ü¶ï "Relax, NASA is watching. We didn\'t have NASA."',
  'ü¶ñ "If nothing hits, we\'re going for ferns."',
  'ü¶ñ "It\'ll definitely fly past. Definitely."',
  'ü¶ï "Statistically? Safe. But statistics killed us."',
  'ü¶ñ "Another false alarm. As usual. Like that one time."',
  'ü¶ï "Look how nicely it flies. The last one flew nicely too."',
  'ü¶ñ "At least we know which direction it\'s coming from."',
  'ü¶ï "Just a flyby today. No landing scheduled."',
  'ü¶ñ "NASA says OK. But what does NASA know about dinosaurs?"',
  'ü¶ï "Another calm day in the Mesozoic... I mean, 2026."',
  'ü¶ñ "Don\'t worry. We shouldn\'t worry. We\'re already dead."',
];

const DINO_COMMENTS_CLOSE = isPl ? [
  'ü¶ñ ‚ÄûTo mi siƒô nie podoba."',
  'ü¶ï ‚ÄûCzy kto≈õ sprawdzi≈Ç matematykƒô?!"',
  'ü¶ñ ‚ÄûMam d√©j√† vu i nie lubiƒô tego."',
  'ü¶ï ‚ÄûPaczka ewakuacyjna spakowana."',
  'ü¶ñ ‚Äû...i dlatego jestem wymar≈Çy."',
  'ü¶ï ‚ÄûM√≥wili ≈ºe przeleci obok. M√≥wili."',
  'ü¶ñ ‚ÄûKiedy≈õ to by≈Ço 10 km. Ten jest mniejszy. Chyba."',
  'ü¶ï ‚ÄûTrike, pamiƒôtasz ten jasny punkt 66 mln lat temu? No w≈Ça≈õnie."',
  'ü¶ñ ‚ÄûSzybko, kto umie kopaƒá norƒô?"',
  'ü¶ï ‚ÄûSpokojnie. Spokojnie. SPOKOJNIE."',
] : [
  'ü¶ñ "I don\'t like this."',
  'ü¶ï "Did anyone double-check the math?!"',
  'ü¶ñ "I\'m having d√©j√† vu and I don\'t like it."',
  'ü¶ï "Emergency bag packed."',
  'ü¶ñ "...and that\'s why I\'m extinct."',
  'ü¶ï "They said it would fly past. They said."',
  'ü¶ñ "That one was 10 km. This one\'s smaller. Probably."',
  'ü¶ï "Trike, remember that bright dot 66M years ago? Exactly."',
  'ü¶ñ "Quick, who can dig a burrow?"',
  'ü¶ï "Calm down. Calm down. CALM DOWN."',
];

// ‚îÄ‚îÄ FUN FACTS ‚îÄ‚îÄ
const FUN_FACTS = isPl ? [
  { emoji: 'ü¶ñ', text: 'Asteroida, kt√≥ra zabi≈Ça dinozaury (<strong>Chicxulub</strong>) mia≈Ça ~10 km ≈õrednicy i uderzy≈Ça z prƒôdko≈õciƒÖ 20 km/s. Energia uderzenia = <strong>10 miliard√≥w bomb atomowych</strong>.' },
  { emoji: 'üåç', text: 'Ziemia jest bombardowana <strong>codziennie</strong> ‚Äî ~100 ton kosmicznego py≈Çu i ma≈Çych meteoryt√≥w spada na nas ka≈ºdego dnia. Wiƒôkszo≈õƒá spala siƒô w atmosferze.' },
  { emoji: 'üî≠', text: 'NASA kataloguje <strong>ponad 34 000</strong> asteroid bliskich Ziemi (NEO). Oko≈Ço 2 400 z nich jest klasyfikowanych jako ‚Äûpotencjalnie niebezpieczne".' },
  { emoji: 'üõ°Ô∏è', text: 'Misja <strong>DART</strong> (2022) udowodni≈Ça, ≈ºe potrafimy zmieniƒá orbitƒô asteroidy. Uderzenie w Dimorphos zmieni≈Ço jego orbitƒô o 33 minuty.' },
  { emoji: '‚òÑÔ∏è', text: '<strong>1 odleg≈Ço≈õƒá ksiƒô≈ºycowa (LD)</strong> = 384 400 km. Astronomowie m√≥wiƒÖ ‚Äûblisko" gdy asteroida mija nas w odleg≈Ço≈õci < 20 LD. Perspektywa kosmiczna jest inna ni≈º ludzka.' },
  { emoji: 'üíé', text: 'Asteroida <strong>16 Psyche</strong> (≈õr. 226 km) jest zbudowana g≈Ç√≥wnie z ≈ºelaza i niklu. Szacowana warto≈õƒá minera≈Ç√≥w: <strong>10 000 biliard√≥w dolar√≥w</strong>.' },
  { emoji: 'ü¶ï', text: 'Dinozaury ≈ºy≈Çy na Ziemi <strong>165 milion√≥w lat</strong>. Ludzie ‚Äî oko≈Ço 300 000. Dinozaury mia≈Çy lepszy track record przetrwania (dop√≥ki nie przylecia≈Ç kamie≈Ñ).' },
  { emoji: 'üå†', text: 'Meteoryt <strong>czelabi≈Ñski</strong> (2013, Rosja) mia≈Ç tylko ~20m i eksplodowa≈Ç w atmosferze z energiƒÖ 30√ó bomby z Hiroszimy. Rannych: 1 500 os√≥b, g≈Ç√≥wnie od wybitych szyb.' },
] : [
  { emoji: 'ü¶ñ', text: 'The asteroid that killed the dinosaurs (<strong>Chicxulub</strong>) was ~10 km wide and hit at 20 km/s. Impact energy = <strong>10 billion atomic bombs</strong>.' },
  { emoji: 'üåç', text: 'Earth is bombarded <strong>daily</strong> ‚Äî about 100 tons of cosmic dust and small meteorites fall on us every day. Most burn up in the atmosphere.' },
  { emoji: 'üî≠', text: 'NASA catalogs <strong>over 34,000</strong> near-Earth objects (NEOs). About 2,400 are classified as "potentially hazardous".' },
  { emoji: 'üõ°Ô∏è', text: 'The <strong>DART</strong> mission (2022) proved we can deflect an asteroid. The impact changed Dimorphos\'s orbit by 33 minutes.' },
  { emoji: '‚òÑÔ∏è', text: '<strong>1 lunar distance (LD)</strong> = 384,400 km. Astronomers say "close" when an asteroid passes within 20 LD. Cosmic perspective is different from human perspective.' },
  { emoji: 'üíé', text: 'Asteroid <strong>16 Psyche</strong> (226 km wide) is made mostly of iron and nickel. Estimated mineral value: <strong>$10 quintillion</strong>.' },
  { emoji: 'ü¶ï', text: 'Dinosaurs lived on Earth for <strong>165 million years</strong>. Humans ‚Äî about 300,000. Dinosaurs had a better survival track record (until the rock came).' },
  { emoji: 'üå†', text: 'The <strong>Chelyabinsk</strong> meteor (2013, Russia) was only ~20m and exploded with 30√ó Hiroshima energy. Injured: 1,500 people, mostly from shattered windows.' },
];

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let asteroids = [];
let nextFlyby = null;
let countdownInterval = null;

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
async function init() {
  document.title = T.pageTitle;
  document.getElementById('loading-text').textContent = T.loading;
  document.querySelector('.hero h1').innerHTML = T.title.replace(T.titleEm, `<em>${T.titleEm}</em>`);
  document.querySelector('.hero-sub').textContent = T.sub;
  document.getElementById('cd-label').textContent = T.nextPass;
  document.getElementById('list-title').textContent = T.listTitle;

  try {
    await fetchAsteroids();
    renderAll();
  } catch (e) {
    document.getElementById('alert-bar').innerHTML = `${T.errorTitle}<div class="alert-sub">${T.errorSub}</div>`;
    console.error('NEO API error:', e);
  }

  document.getElementById('loading').classList.add('hidden');
  startCountdown();
  rotateDinoComment();
  rotateFunFact();
}

// ‚îÄ‚îÄ NASA NEO API ‚îÄ‚îÄ
async function fetchAsteroids() {
  const today = new Date();
  const end = new Date(today);
  end.setDate(end.getDate() + 7);

  const fmt = d => d.toISOString().split('T')[0];
  const url = `https://api.nasa.gov/neo/rest/v1/feed?start_date=${fmt(today)}&end_date=${fmt(end)}&api_key=DEMO_KEY`;

  const resp = await fetch(url);
  if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
  const data = await resp.json();

  asteroids = [];
  for (const [date, list] of Object.entries(data.near_earth_objects)) {
    for (const neo of list) {
      const ca = neo.close_approach_data[0];
      if (!ca) continue;
      asteroids.push({
        id: neo.id,
        name: neo.name.replace(/[()]/g, '').trim(),
        date: ca.close_approach_date_full || ca.close_approach_date,
        dateObj: new Date(ca.close_approach_date_full ? ca.close_approach_date_full.replace(/(\d+)-(\w+)-(\d+)/, '$3-$2-$1') : ca.close_approach_date),
        epochMs: ca.epoch_date_close_approach,
        distKm: parseFloat(ca.miss_distance.kilometers),
        distLD: parseFloat(ca.miss_distance.lunar),
        speedKmh: parseFloat(ca.relative_velocity.kilometers_per_hour),
        speedKms: parseFloat(ca.relative_velocity.kilometers_per_second),
        diamMinM: neo.estimated_diameter.meters.estimated_diameter_min,
        diamMaxM: neo.estimated_diameter.meters.estimated_diameter_max,
        hazardous: neo.is_potentially_hazardous_asteroid,
      });
    }
  }

  // Fix dateObj using epoch if available
  for (const a of asteroids) {
    if (a.epochMs) a.dateObj = new Date(a.epochMs);
  }

  asteroids.sort((a, b) => a.dateObj - b.dateObj);
  document.getElementById('status-text').textContent =
    `${asteroids.length} ${isPl ? 'asteroid' : 'asteroids'} ¬∑ NASA NEO API ¬∑ ${isPl ? 'aktualizacja co godzinƒô' : 'updated hourly'}`;
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
function renderAll() {
  renderAlert();
  renderCountdownInit();
  renderList();
  showFunFact();
}

function renderAlert() {
  const bar = document.getElementById('alert-bar');
  const hasHazardous = asteroids.some(a => a.hazardous);
  const closest = asteroids.length > 0 ? asteroids.reduce((a, b) => a.distKm < b.distKm ? a : b) : null;

  if (hasHazardous) {
    bar.classList.add('warn');
    bar.classList.remove('danger');
    bar.innerHTML = `${T.warnTitle}<div class="alert-sub">${T.warnSub}</div>`;
  } else {
    bar.classList.remove('danger', 'warn');
    bar.innerHTML = `${T.safe}<div class="alert-sub">${T.safeSub}</div>`;
  }
}

function formatDistKm(km) {
  if (km >= 1e6) return `${(km/1e6).toFixed(1)} mln km`;
  return `${Math.round(km/1000).toLocaleString()} tys. km`;
}

function renderCountdownInit() {
  const now = Date.now();
  const upcoming = asteroids.filter(a => a.dateObj.getTime() > now);
  nextFlyby = upcoming.length > 0 ? upcoming[0] : (asteroids.length > 0 ? asteroids[0] : null);

  if (!nextFlyby) return;

  document.getElementById('cd-name').textContent = nextFlyby.name;
  const [sizeText, sizeEmoji] = sizeCompare(nextFlyby.diamMinM, nextFlyby.diamMaxM);

  document.getElementById('cd-stats').innerHTML = `
    <div class="cd-stat dist">
      <div class="cd-stat-value">${distLabelShort(nextFlyby.distLD)}</div>
      <div class="cd-stat-label">${distLabelUnit(nextFlyby.distLD)}</div>
      <div class="cd-stat-label">${formatDistKm(nextFlyby.distKm)}</div>
    </div>
    <div class="cd-stat speed">
      <div class="cd-stat-value">${Math.round(nextFlyby.speedKms)} km/s</div>
      <div class="cd-stat-label">${isPl ? 'prƒôdko≈õƒá lotu' : 'speed'}</div>
    </div>
    <div class="cd-stat size">
      <div class="cd-stat-value">${sizeText}</div>
      <div class="cd-stat-label">${isPl ? 'wielko≈õƒá' : 'size'}</div>
    </div>
  `;
}

function startCountdown() {
  if (countdownInterval) clearInterval(countdownInterval);
  countdownInterval = setInterval(() => {
    if (!nextFlyby) return;
    const diff = nextFlyby.dateObj.getTime() - Date.now();
    const el = document.getElementById('cd-time');

    if (diff <= 0) {
      el.textContent = isPl ? 'W≈ÅA≈öNIE TERAZ!' : 'RIGHT NOW!';
      el.style.color = 'var(--accent)';
      return;
    }

    const d = Math.floor(diff / 86400000);
    const h = Math.floor((diff % 86400000) / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);

    let str = '';
    if (d > 0) str += `${d}${T.days} `;
    str += `${h}${T.hours} ${String(m).padStart(2,'0')}${T.min} ${String(s).padStart(2,'0')}${T.sec}`;
    el.textContent = str;
  }, 1000);
}

function renderList() {
  const loc = isPl ? 'pl-PL' : 'en-GB';
  const list = document.getElementById('asteroid-list');

  list.innerHTML = asteroids.map((a, i) => {
    const [sizeText, sizeEmoji] = sizeCompare(a.diamMinM, a.diamMaxM);
    const dateStr = a.dateObj.toLocaleDateString(loc, { day: 'numeric', month: 'short' });
    const timeStr = a.dateObj.toLocaleTimeString(loc, { hour: '2-digit', minute: '2-digit' });
    const hazTag = a.hazardous ? `<span class="hazard-tag">‚ö†Ô∏è ${T.hazardous}</span>` : '';

    const threat = a.hazardous ? 'threat-danger' : a.distLD < 10 ? 'threat-medium' : 'threat-safe';
    return `<div class="asteroid-card ${threat}" style="animation-delay: ${i * 0.05}s">
      <div class="asteroid-header">
        <div class="asteroid-icon">${sizeEmoji}</div>
        <div>
          <h3>${a.name}</h3>
          <div class="date">${dateStr} ${timeStr}</div>
        </div>
        ${hazTag}
      </div>
      <div class="asteroid-stats-row">
        <div class="stat-cell s-dist">
          <div class="stat-label">${isPl ? 'Odleg≈Ço≈õƒá' : 'Distance'}</div>
          <div class="stat-value">${distLabelShort(a.distLD)}</div>
          <div class="stat-sub">${distLabelUnit(a.distLD)}</div>
          <div class="stat-sub">${formatDistKm(a.distKm)}</div>
        </div>
        <div class="stat-cell s-speed">
          <div class="stat-label">${isPl ? 'Prƒôdko≈õƒá' : 'Speed'}</div>
          <div class="stat-value">${Math.round(a.speedKms)} km/s</div>
          <div class="stat-sub">${Math.round(a.speedKmh).toLocaleString()} km/h</div>
        </div>
        <div class="stat-cell s-size">
          <div class="stat-label">${isPl ? 'Wielko≈õƒá' : 'Size'}</div>
          <div class="stat-value">${sizeText}</div>
          <div class="stat-sub">${Math.round(a.diamMinM)}‚Äì${Math.round(a.diamMaxM)} m</div>
        </div>
      </div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ ROTATING COMMENTS (shuffle ‚Äî no repeats until all shown) ‚îÄ‚îÄ
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

let dinoQueue = [];
function nextDinoComment() {
  const hasHazardous = asteroids.some(a => a.hazardous);
  const pool = hasHazardous ? DINO_COMMENTS_CLOSE : DINO_COMMENTS_SAFE;
  if (dinoQueue.length === 0) dinoQueue = shuffle(pool);
  return dinoQueue.pop();
}

function rotateDinoComment() {
  const el = document.getElementById('dino-comment');
  el.style.transition = 'opacity 0.4s';

  setInterval(() => {
    el.style.opacity = '0';
    setTimeout(() => {
      el.textContent = nextDinoComment();
      el.style.opacity = '1';
    }, 400);
  }, 8000);
}

function showFunFact() {
  const el = document.getElementById('funfact');
  const fact = FUN_FACTS[Math.floor(Math.random() * FUN_FACTS.length)];
  el.innerHTML = `<div class="dino-emoji">${fact.emoji}</div><p>${fact.text}</p>`;
}

function rotateFunFact() {
  setInterval(() => {
    const el = document.getElementById('funfact');
    el.style.opacity = '0.3';
    setTimeout(() => {
      const fact = FUN_FACTS[Math.floor(Math.random() * FUN_FACTS.length)];
      el.innerHTML = `<div class="dino-emoji">${fact.emoji}</div><p>${fact.text}</p>`;
      el.style.opacity = '1';
    }, 400);
  }, 15000);
  document.getElementById('funfact').style.transition = 'opacity 0.4s';
}

// ‚îÄ‚îÄ START ‚îÄ‚îÄ
init();
</script>
</body>
</html>
